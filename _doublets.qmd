## Doublet detection

- A doublet is a single-cell transcriptome that has been generated by two cells
- They have often have a higher read and gene count
- They can produce confounding results

![Doublets, adapted from [@wolock2019scrublet]](figures/doublets_scubletpaper.png)

How do we fight doublets:

- Experiment design
- Computationally

### Scrublet

Scrublet finds doublets based os simulations [@wolock2019scrublet]

![Scrublet algorithm overview [@wolock2019scrublet]](figures/scrublet.png)

```{python}
scrub = scr.Scrublet(adata.X, expected_doublet_rate=0.06)
doublet_scores, predicted_doublets = scrub.scrub_doublets()
scrub.plot_histogram()
```

Adjust threshold

```{python}
predicted_doublets = scrub.call_doublets(threshold=0.2)
scrub.plot_histogram()
```

Visualise doublets

```{python}
scrub.set_embedding('UMAP', scr.get_umap(scrub.manifold_obs_, 10, min_dist=0.3))
scrub.plot_embedding('UMAP', order_points=True);
```

Filter out doublets

```{python}
adata.obs["scrublet_doublet"] = predicted_doublets
adata = adata[adata.obs["scrublet_doublet"].apply(lambda x: x is False)]
```
